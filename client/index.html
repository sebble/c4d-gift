<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>GIFT</title>

                <meta name="description" content="">
                        <meta name="HandheldFriendly" content="True">
                                <meta name="MobileOptimized" content="320">
                                        <meta name="viewport" content="width=device-width, initial-scale=1">
                                                <meta http-equiv="cleartype" content="on">
    </head>
    <body>
        <style>
            li {
                width: 90%;
                border: solid 1px #333;
                border-radius: 5px;
                list-style: none;
                margin: .5em;
                padding: .5em;
                background-color: #eee;
                position: relative;
            }
            li > .fill {
                background-color: #09f;
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 15%;
                z-index: 1;
            }
            li > span {
                position: relative;
                z-index: 5;
            }
            li.selected {
                outline: solid 3px #900;
            }
            /*ul.recording .selected .fill {
                -webkit-animation: flash linear 2s infinite;
                animation: flash linear 2s infinite;
            }
            @-webkit-keyframes flash {
                0% { outline: solid 3px #900; } 
                50% { opacity: .1; } 
                100% { opacity: 1; }
            }
            @keyframes flash {
                0% { opacity: 1; } 
                50% { opacity: .1; } 
                100% { opacity: 1; }
            }*/

            button {
                width: 70%;
            }
        </style>
        <ul>
            <!--<li><div class="fill"></div><span>All</span></li>-->
            <li class="person"><div class="fill"></div><span>Connor</span></li>
            <li class="person"><div class="fill"></div><span>Mary</span></li>
            <li class="person"><div class="fill"></div><span>Sam</span></li>
            <li class="person"><div class="fill"></div><span>Sebastian</span></li>
            <li><button id="stop" disabled>Stop</button></li>
            <!--<li><audio id="rec" controls="controls"></audio></li>-->
        </ul>
        <script src="//cdn.webrtc-experiment.com/RecordRTC.js"></script>
        <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>

        var isFirefox = true;

            navigator.getUserMedia = navigator.getUserMedia ||
                                     navigator.webkitGetUserMedia ||
                                     navigator.mozGetUserMedia;

            var recordRTC;
            navigator.getUserMedia({audio:true,video:false}, function(mediaStream){
                recordRTC = RecordRTC(mediaStream); 
            }, function(e){console.log(e);});
            var recording = function(){return $('ul').hasClass('recording');};
            var record = function(){return $('ul').addClass('recording');};

function upload(blob){

var fileType = 'audio'; // or "audio"
var fileName = 'sam.wav';  // or "wav"

users = 'sam';

var formData = new FormData();
formData.append(fileType + '-filename', fileName);
formData.append(fileType + '-blob', blob);

xhr('/server/rcv.php', formData, function (fName) {
    console.log(fName);
    //window.open(location.href + fName);
});

function xhr(url, data, callback) {
    var request = new XMLHttpRequest();
    request.onreadystatechange = function () {
        if (request.readyState == 4 && request.status == 200) {
            callback(location.href + request.responseText);
        }
    };
    request.open('POST', url);
    request.send(data);
}

}


            var stop = function(){return $('ul').removeClass('recording');};

            $(function(){

                $('#stop').click(function(){
                    $('ul').removeClass('recording');
                    $('#stop').attr('disabled','disabled');
                    $('li').removeClass('selected');

                    recordRTC.stopRecording(function(audioURL) { 
                        document.getElementById('rec').src = audioURL; 
                        upload(recordRTC.getBlob());
                    });
                });
                
                $('.person').click(function(){

                    $(this).toggleClass('selected');
                    $('#stop').attr('disabled',false);

                    if (!recording()) {
                        $('ul').addClass('recording');
                        recordRTC.startRecording(); 
                    }

                });
                
            });

        </script>
    </body>
</html>
